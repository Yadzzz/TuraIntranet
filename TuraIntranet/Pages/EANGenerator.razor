@page "/eangenerator"

@inject PageNavigationService PageNavService
@inject NotificationService Notification
@inject EANGeneratorService EANService

<PageTitle>EAN Generator</PageTitle>

<link rel="stylesheet" type="text/css" href="plugins/table/datatable/datatables.css">
<link rel="stylesheet" type="text/css" href="plugins/table/datatable/dt-global_style.css">

<div id="content" class="main-content">
    <div class="layout-px-spacing">

        <div class="row layout-top-spacing" id="cancel-row">

            <div class="col-xl-12 col-lg-12 col-sm-12  layout-spacing">
                <div class="widget-content widget-content-area br-6">

                    <br />
                    <center><h5>EAN13 Generator</h5></center>
                    <br />

                    <div class="form-group row" style="padding-left:25px;">
                        <div class="col-sm-2">
                            <label>Företagsprefix</label>
                            <select name="nät" class="form-control country_code  form-control-sm" @onchange=@OnChangeCompanyPrefix>
                                <option value="0">Prefix</option>
                                <option value="731992">731992</option>
                            </select>
                        </div>

                        <div class="col-sm-2">
                            <label>Artikel</label>
                            <input type="text" class="form-control form-control-sm" placeholder="Artikel" @bind-value=@this.articleIdInput>
                        </div>

                        <div class="col-xl-2 col-md-4">
                            <label>Skapa EAN-13</label>
                            <button class="btn btn-dark btn-block mb-4 mr-2" @onclick=@this.Calculate>Skapa</button>
                        </div>
                    </div>

                    <hr />

                    @if (!string.IsNullOrEmpty(this.calculatedEAN13))
                    {
                        <div class="form-group row" style="padding-left:25px;">

                            <div class="col-xl-2 col-md-4">
                                <label>EAN-13</label>
                                <input type="text" class="form-control form-control-sm" value="@this.calculatedEAN13">
                            </div>
                        </div>
                    }

                </div>
            </div>

        </div>

    </div>
    <Footer />
</div>

@code {
    private string companyPrefixInput = string.Empty;
    private string articleIdInput = string.Empty;
    private string calculatedEAN13 = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        this.PageNavService.UpdateActiveSection("");
        this.PageNavService.UpdateActivePage("EANGenerator");
        this.StateHasChanged();
    }

    private void OnChangeCompanyPrefix(ChangeEventArgs e) => this.companyPrefixInput = e?.Value?.ToString() ?? string.Empty;

    private void Calculate()
    {
        if(string.IsNullOrEmpty(this.companyPrefixInput) || string.IsNullOrEmpty(this.articleIdInput))
        {
            Task.Run(() => this.Notification.AlertError("Vänligen fyll i alla kollumner!")).Wait();
            this.Reset();
            return;
        }

        this.calculatedEAN13 = this.EANService.CalculateEan13(this.companyPrefixInput, this.articleIdInput);
        this.StateHasChanged();

        Task.Run(() => this.Notification.AlertSuccess("EAN-13 Skapad"));
    }

    private void Reset()
    {
        this.articleIdInput = string.Empty;
        this.calculatedEAN13 = string.Empty;
        this.StateHasChanged();
    }
}
